<!doctype html>
<html>
	<head>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script>
			var debugEl;
			
			function apiRequest(endpoint, uri, helper, data)
			{
				var object = {
					'url': uri,
					'data': data
				};
				helper.postMessage(JSON.stringify(object), endpoint);
			}
			
			function create_helper()
			{
				$('<iframe src="http://api.anontune.local/1/crossdomain/" width=1 height=1></iframe>').appendTo('body');
			}

			$(function(){
				$(window).bind("message", function(event){
					var response = event.originalEvent.data;
					
					if(response == "READY")
					{
						helper = event.originalEvent.source;
						
						apiRequest("http://api.anontune.local", "/2/artist/4", helper, {
							'test': "ohai",
							'herp': "derp"
						});
					}
					else
					{
						alert(response);
						
						var object = JSON.parse(response);
						console.log(object);
					}
				})
			})
		</script>
	</head>
	<body>
		<button onclick="create_helper();">Test</button>
	</body>
</html>
